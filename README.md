# DiceSimulator

公開デモ（Streamlit Community Cloud）: https://dicesimulator-t-narumi-ukk.streamlit.app

$m$人がそれぞれ$n$回サイコロを振る状況について，標本平均の分布を可視化するデモアプリです．
Streamlitで動作し，中心極限定理（central limit theory; CLT. サンプルサイズが大きいと正規分布に近づく）と大数の法則（law of large number; LLN. 標本平均が真の平均3.5に収束する）を直感的に確認できます．
標本平均のヒストグラムと，サイコロを振る回数（サンプルサイズ）を増やしたときの累積平均の収束をPNGとして表示・ダウンロードできます．
入力値を変更すると即時に再計算されます（ボタン操作は不要）．

## 特徴
- m（サンプル数）と n（サンプルサイズ）を入力してシミュレーションを実行
- 標本平均のヒストグラムに正規近似をオーバーレイ表示
- 1人あたりのサイコロを振る回数（サンプルサイズ）を増やしたときの累積平均の推移（大数の法則デモ）を折れ線グラフで表示
- ヒストグラムの x / y 軸範囲を手動設定可能
- 2つの図をそれぞれPNGとしてダウンロード可能
- 乱数シードを指定すれば再現可能，未指定なら都度ランダム
- KS 検定で標本分布と正規近似の一致度を表示（KS statistic と p-value を表示．KS statistic は0に近いほど差が小さく，p は小さいほど正規近似からの逸脱を示唆）
  - m の範囲: 1 〜 1,000,000
  - n の範囲: 1 〜 100,000（計算量に注意，n×m ≤ 1e8 を推奨）

## 依存関係
`requirements.txt` を参照してください（`streamlit`, `numpy`, `matplotlib`, `scipy`）．

## 使い方
1. 依存ライブラリをインストールします．
   ```bash
   pip install -r requirements.txt
   ```
2. Streamlitアプリを起動します．
   ```bash
   streamlit run app.py
   ```
3. ブラウザで開いたページのサイドバーで以下を設定すると自動で再計算されます（ボタン操作は不要です）．
   - Simulation settings: `Number of samples; m`（標本数，デフォルト 1000），`Sample size; n`（1人がサイコロを振る回数，デフォルト 10）
   - Plot options: ヒストグラムの x / y 軸範囲を手動設定可能（未指定時は x を 1〜6 に固定，y は自動）．累積平均の y は 1〜6 に固定．
   - Simulation options: 「乱数シードを指定する」にチェックして seed（整数）を入力すると再現可能（チェックしなければ毎回ランダム）
4. メイン画面にヒストグラムと累積平均（サンプルサイズ方向）のグラフが表示されます．各グラフ下のボタンからPNGをダウンロードできます（ヒストグラムは n と m を，累積平均は n をファイル名に含みます）．
   - 入力変更のたびに再計算するため，n×m が大きい設定では計算量にご注意ください（n×m ≤ 1e8 を推奨）．

## 挙動の詳細（m と n の役割）
- ヒストグラム（左図）は m 個の標本について標本分布を描きます．1標本あたり n 回サイコロを振ってその出た目を平均し，その平均を m 個集めた分布です．m を増やすとヒストグラムがなめらかになり，n を増やすと正規分布に近づきます（中心極限定理）．
- 累積平均（右図）は 1 つの標本（サンプルサイズ n）の「先頭 k 回までの平均」を k=1..n で描くものです．横軸はサンプルサイズ，縦軸はその時点までの平均で，n を大きくするほど 3.5 への収束の様子が長いスパンで見られます（大数の法則）．この図には m は影響しません．
- seed を指定すると同じ乱数系列からヒストグラム用の標本平均と，累積平均用のロール列を生成するので再現可能です．

## 補足
- サイドバーで n や m を調整して実行し直すことで，比較が簡単にできます．
- KS統計量は0に近いほど標本分布と正規近似の差が小さいです．
- p値は「正規分布と矛盾するほど差が大きいか」の指標で，小さいほど逸脱を示唆します．一般的な「p値は小さいほど良い」というイメージとは逆に，ここでは p が大きいほど正規近似と矛盾しない（棄却できない）と読みます．
